<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <title>Listagem Peneira</title>
   
    <style> 
        .form-container {
            max-width: 1280px;
            padding: 1rem;
            margin: 0 auto ; /* Centraliza o conteúdo na página */
        }
        /* Define a largura de cada coluna */
        .table th, .table td {
            width: 25%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <h1>Inscritos</h1>
            <hr>
            <div id="output"></div>
        </div>
        <div class="row">
            <table class="table">
                <thead>
                  <tr>
                    <th>Opções</th>
                    <th scope="col">Nome</th>
                    <th scope="col">Posição</th>
                    <th scope="col">E-mail</th>
                  </tr>
                </thead>
                <tbody id="exibir">
                  
                </tbody>
              </table>
        </div>
        <div class="row">
            <div class="col">
                <a class="icon-link getout" onclick="sair()">
                    Sair
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <!-- Modal de Edição do Cliente -->
    <div class="modal fade" id="editarClienteModal" tabindex="-1" aria-labelledby="editarClienteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="editarClienteModalLabel">Editar Cliente</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <form id="editarClienteForm">
                <div class="mb-3">
                    <label for="editNome" class="form-label">Nome</label>
                    <input type="text" class="form-control" id="editNome" name="editNome" required>
                </div>
                <div class="mb-3">
                    <label for="editEmail" class="form-label">E-mail</label>
                    <input type="email" class="form-control" id="editEmail" name="editEmail" required>  
                </div>
                <div class="mb-3">
                    <label for="position" class="form-label">Posição em Campo</label>
                    <select name="position" id="position">
                        <option value="indefinido" selected disabled>Posição no campo</option>
                        <option value="GO">GOLEIRO</option>
                        <option value="ZAG">ZAGUEIRO</option>
                        <option value="LE">LATERAL ESQUERDA</option>
                        <option value="LD">LATERAL DIREITA</option>
                        <option value="VOL">VOLANTE</option>
                        <option value="MD">MEIA DIREITA</option>
                        <option value="ME">MEIA ESQUERDA</option>
                        <option value="PD">PONTA DIREITA</option>
                        <option value="PE">PONTA ESQUERDA</option>
                        <option value="AT">ATACANTE</option>
                    </select>
                </div>
                <input type="hidden" id="editClientId" name="editClientId">
            </form>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <button type="button" class="btn btn-primary" onclick="salvarEdicao()">Salvar</button>
            </div>
        </div>
        </div>
    </div>
  

    <script>

        const sair = () => {
            localStorage.clear();
            window.location.href = 'login.html';
        }
        
        const token = localStorage.getItem('token');
        
        const verificarAutenticacao = () => {
            if(!token) window.location.href = 'login.html';
        }

        const buscarDados = () => {
            axios.get(`http://localhost:3000/cliente`).then((response)=>{
                console.log(token)
                
                document.querySelector('#exibir').innerHTML = response.data.map((resp) => {
                    return( 
                        '<tr>' +
                            '<td class="">' +
                                '<button type="button" class="btn btn-outline-info btn-sm" onclick="abrirModalEdicao(\''+resp._id+'\', \''+resp.user+'\', \''+resp.email+'\')">Editar</button>' +
                                '<a class="btn btn-outline-danger btn-sm" href="#" role="button" onclick="javascript:return excluirCliente(`'+resp._id+'`);">Excluir</a>' +
                            '</td>' +
                            '<td>'+ resp.user +'</td>' +
                            '<td>'+ resp.position +'</td>'  +
                            '<td>'+ resp.email +'</td>'  +
                            '</tr>')}
                        ).join('');
                    }).catch(err => document.querySelector('#output').innerHTML = '<div class="alert alert-danger" role="alert">'+ err.message +'</div>')
                }
        function excluirCliente(id){
            axios.delete(`http://localhost:3000/cliente/${id}`).then((response) => {
                console.log(response)
                window.location.reload();
            }); 
        }
        function abrirModalEdicao(id, nome, email, position = 'indefinido') {
            document.getElementById('editClientId').value = id;
            document.getElementById('editNome').value = nome;
            document.getElementById('editEmail').value = email;
            document.getElementById('position').value = position;
            let modal = new bootstrap.Modal(document.getElementById('editarClienteModal'));
            modal.show();
        }

        function salvarEdicao() {
            let id = document.getElementById('editClientId').value;
            let nome = document.getElementById('editNome').value;
            let email = document.getElementById('editEmail').value;
            let position = document.getElementById('position').value;
            

            axios.put(`http://localhost:3000/cliente/${id}`, {
                    userId: id,
                    user: nome,
                    email: email,
                    position: position,
                }, {
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then((response) => {
                    console.log(response.data);
                    window.location.reload(); 
                })
                .catch((error) => {
                    console.error(error);
                    alert("Erro ao editar cliente. Verifique o console para mais detalhes.");
                });
            }
                

        verificarAutenticacao(); 
        buscarDados();
    </script>

</body>
</html>